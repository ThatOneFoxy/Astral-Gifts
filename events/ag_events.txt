namespace = ag_events

country_event = {
    id = ag_events.100
    hide_window = yes
    is_triggered_only = yes

    immediate = {
     add_modifier = { modifier = ag_midgame_astral_storage }
    }
}

event = {
    id = astral_planes.1
    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_astral_planes_dlc = yes
    }

    immediate = {
        get_galaxy_setup_value = {
            setting = num_stars
            which = local_astral_scar_num
            scale_by = 0.1
        }

        while = {
            count = local_astral_scar_num

            reroll_random = yes

            random_system = {
                limit = {
                    NOR = {
                        exists = owner
                        any_neighbor_system = {
                            exists = owner
                        }
                    }
                    can_spawn_astral_rift_natural_generation = yes
                }

                weights = {
                    inline_script = "astral_rift/spawn_weights"
                }

                spawn_astral_scar = yes
            }
        }
    }
}

# Progressive Astral Scar spawn
event = {
    id = astral_planes.2
    hide_window = yes

    is_triggered_only = yes

    trigger = {
        has_astral_planes_dlc = yes
        mid_game_years_passed >= 0
    }

    immediate = {
        every_playable_country = {
            limit = {
                NOT = { has_country_flag = astral_rift_spawn_moratorium }
                is_astral_rift_pool_empty = no
            }
            random_planet_within_border = {
                limit = {
                    is_astral_scar = no
                }
                spawn_astral_scar = yes
            }
        }
    }
}
